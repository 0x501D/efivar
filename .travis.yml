language: c
cache: ccache
branches:
  except:
    - travis

matrix:
 include:
   - os: linux
     dist: trusty
     services: docker

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then docker pull vathpela/efivar-travis-rawhide:v1 ; fi

before_script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then echo FROM vathpela/efivar-travis-rawhide:v1 > Dockerfile ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then echo ADD . /root >> Dockerfile ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then docker build -t withgit . ; fi

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]&& then docker run --volume $HOME/.ccache:/root/.ccache withgit /bin/sh -c "cd ${TRAVIS_BUILD_DIR} && git remote -v && git status && git checkout -f ${TRAVIS_PULL_REQUEST_SHA} && make clean all"
  - ccache -s
